"use strict";!function(e,t){var r=e.body,n=(e.querySelector("main"),e.querySelector("footer")),i=function(e){return Array.prototype.sort.call(e,function(){return Math.random()>.5?1:-1}),e},l=function(e,t){if(t>e.length||t<=0)return!1;for(var r=[],n=0;n<t;n++){var i=Math.floor(Math.random()*e.length+1)-1;r.push(e.splice(i,1)[0])}return r},o=function(){var t=Array.prototype.slice.call(e.querySelectorAll("main>div"));t.forEach(function(e){"block"===e.style.display&&(e.style.display="none")})},c=function(){var t=e.querySelector("#indexBtn");t.addEventListener("click",function(){o(),e.querySelector("main").style.display="none"},!1)},a=function(){var t="",r=e.querySelector(".signIn header i"),n=e.querySelector(".signIn ul"),i=function l(e){$.getJSON(e,function(e){if(t!==JSON.stringify(e)){var i="";t=JSON.stringify(e),r.innerHTML=e.length,e.forEach(function(e){e.headimgurl||(e.headimgurl="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"),i+="<li><img src="+e.headimgurl+' alt="headImg"><p>'+e.nickname+"</p></li>"}),n.innerHTML=i}}),setTimeout(function(){l(e)},5e3)};e.querySelector("#SignBtn").addEventListener("click",function(){o(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),e.querySelector(".signIn").style.display="block",i("http://120.26.53.25/wechat/Project/api/getActiveUser/")},!1)},u=function(){var t=function r(){$.getJSON("http://120.26.53.25/wechat/Project/api/getMessage/",function(t){var r="";t.forEach(function(e){r+='<li><img src="'+e.headimgurl+'" alt=""><div><p>'+e.nickname+"</p><strong>"+e.content+"</strong></div></li>"}),e.querySelector(".message .pull-right").innerHTML=r}),setTimeout(r,5e3)};t(),e.querySelector("#msgBtn").addEventListener("click",function(){o(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),e.querySelector(".message").style.display="block"},!1)},s=function(){var r=e.querySelector("#timeBtn");r.addEventListener("click",function(){var r=e.querySelector(".time"),n=e.querySelector("#timeText"),i=e.querySelector(".time button");o(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),r.style.display="block";var l=echarts.init(document.getElementById("timeBox")),c={total:60,used:0};n.innerHTML=c.total-c.used,n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px";var a={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};l.setOption(a);var u=function s(){if(c.used>=60)return n.innerHTML="时间到",n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px",i.removeAttribute("disabled"),!0;c.used++,n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px";var e={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};l.setOption(e),n.innerHTML=c.total-c.used,setTimeout(s,1e3)};i.addEventListener("click",function(){i.setAttribute("disabled","disabled"),u()},!1)},!1)},p=function(){var r=!1,n=function(t){var r="";t.forEach(function(e){r+="<li>"+e.level+"</li>"}),e.querySelector(".prizeLevel ul").innerHTML=r,e.querySelector(".prizeLevel p i").innerHTML=e.querySelector(".prizeLevel ul").firstElementChild.innerHTML},c=function(){"hide"===e.querySelector(".prizeLevel ul").className?e.querySelector(".prizeLevel ul").className="show":e.querySelector(".prizeLevel ul").className="hide"},a=function(t){t.forEach(function(t){t.level===e.querySelector(".prizeLevel p i").innerHTML&&(e.querySelector(".prizePic img").src=t.picUrl)})},u=function(t,r){var n=0,i=r.length;t.forEach(function(t){e.querySelector(".prizeLevel p i").innerHTML===t.level&&(n=t.num)}),e.querySelector(".prizeNum span").innerHTML>Math.min(n,i)&&(e.querySelector(".prizeNum span").innerHTML=Math.min(n,i));for(var l="",o=0;o<e.querySelector(".prize .pull-right .prizeNum span").innerHTML;o++)l+='<li><img src="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"><p>...</p></li>';e.querySelector(".prize .pull-left ul").innerHTML=l},s=function g(t,n,i){var l=arguments.length<=3||void 0===arguments[3]?0:arguments[3],o=Array.prototype.slice.call(e.querySelectorAll(".prize .pull-left ul li"));l>=n.length&&(l=0),o.forEach(function(e){t[n[l]].headimgurl||(t[n[l]].headimgurl="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"),e.querySelector("img").src=t[n[l]].headimgurl,e.querySelector("p").innerHTML=t[n[l]].nickname}),setTimeout(function(){r&&g(t,n,i,++l)},i)},p=function(e,t){for(var r=[],n=0;n<t.length;n++)r.push(n);r=i(r),s(t,r,100)},d=function(t){for(var r=[],n=[],i=[],o=0;o<t.length;o++)r.push(o);return n=l(r,e.querySelectorAll(".prize .pull-left ul li").length),n.forEach(function(e){i.push(t[e])}),i},y=function(t){for(var r=Array.prototype.slice.call(e.querySelectorAll(".prize .pull-left ul li")),n=0;n<r.length;n++)r[n].querySelector("img").src=t[n].headimgurl,r[n].querySelector("p").innerHTML=t[n].nickname},h=function(t,r){var n=[],i=null;t.forEach(function(t){e.querySelector(".prizeLevel p i").innerHTML===t.level&&(i=t.id)}),r.forEach(function(e){var t={};t.openid=e.openid,t.prizeId=i,n.push(t)}),n=JSON.stringify(n),$.post("http://120.26.53.25/wechat/Project/api/receivePrizeUser/",n)};e.querySelector("#giftBtn").addEventListener("click",function(){o(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),e.querySelector(".prize").style.display="block"},!1),$.getJSON("http://120.26.53.25/wechat/Project/api/getPrizeData/",function(i){$.getJSON("http://120.26.53.25/wechat/Project/api/getToPrizeUser/",function(l){n(i),a(i),e.querySelector(".prizeLevel").addEventListener("click",c,!1),e.querySelector(".prizeLevel ul").addEventListener("click",function(r){var n=t.event||r;"LI"===n.target.nodeName&&(e.querySelector(".prizeLevel p i").innerHTML=n.target.innerHTML,a(i),u(i,l))},!1),e.querySelector(".lessBtn").addEventListener("click",function(){var t=parseInt(e.querySelector(".prizeNum span").innerHTML);t>0&&(e.querySelector(".prizeNum span").innerHTML=--t,u(i,l))},!1),e.querySelector(".addBtn").addEventListener("click",function(){var t=l.length,r=0;i.forEach(function(t){t.level===e.querySelector(".prizeLevel i").innerHTML&&(r=t.num)});var n=parseInt(e.querySelector(".prizeNum span").innerHTML);n<Math.min(t,r)&&(e.querySelector(".prizeNum span").innerHTML=++n,u(i,l))},!1),e.querySelector(".prizeBtn").addEventListener("click",function(e){var n=t.event||e;$.getJSON("http://120.26.53.25/wechat/Project/api/getToPrizeUser/",function(e){if("start"===n.target.innerHTML)r=!0,p(i,e),n.target.innerHTML="stop";else{r=!1,n.target.innerHTML="start";var t=d(e);y(t),h(i,t)}})},!1)})})},d=function(){var t=e.querySelector("#voteBtn");t.addEventListener("click",function(){var t=e.querySelector(".vote"),r="";t.className="vote show";var n=echarts.init(e.querySelector(".voteMain")),i=e.querySelector(".vote i"),l=function o(e){$.getJSON(e,function(e){if(r!==JSON.stringify(e)){var t=0;e.forEach(function(e){t+=parseInt(e.num)}),i.innerHTML=t;var l={color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:[e[0].lead,e[1].lead,e[2].lead,e[3].lead],axisTick:{alignWithLabel:!0},axisLabel:{textStyle:{color:"#fff"}}}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}}}],series:[{name:"票数",type:"bar",barWidth:"60%",data:[e[0].num,e[1].num,e[2].num,e[3].num]}]};n.setOption(l),r=JSON.stringify(e)}}),setTimeout(function(){o(e)},5e3)};l("http://120.26.53.25/wechat/Project/api/vote")},!1)},y=function(){n.addEventListener("mouseover",function(){n.className="hover"},!1),n.addEventListener("mouseout",function(){n.className=""},!1)},h=function(){var n=e.querySelector("#setCloseBtn"),i=e.querySelector("#setBtn"),l={bg1Url:"http://o7qephszd.bkt.clouddn.com/wechatBg1.jpg",bg2Url:"http://o7qephszd.bkt.clouddn.com/wechatBg2.jpg",bg3Url:"http://o7qephszd.bkt.clouddn.com/wechatBg3.jpg",bg4Url:"http://o7qephszd.bkt.clouddn.com/wechatBg4.jpg",bg5Url:"http://o7qephszd.bkt.clouddn.com/wechatBg5.jpg",bg6Url:"http://o7qephszd.bkt.clouddn.com/wechatBg6.jpg",bg7Url:"http://o7qephszd.bkt.clouddn.com/wechatBg7.jpg",bg8Url:"http://o7qephszd.bkt.clouddn.com/wechatBg8.jpg",bg9Url:"http://o7qephszd.bkt.clouddn.com/wechatBg9.jpg",bg10Url:"http://o7qephszd.bkt.clouddn.com/wechatBg10.jpg",bg11Url:"http://o7qephszd.bkt.clouddn.com/wechatBg11.jpg",bg12Url:"http://o7qephszd.bkt.clouddn.com/wechatBg12.jpg"};i.addEventListener("click",function(){n.parentNode.parentNode.className="show",setTimeout(function(){n.parentNode.parentNode.style="opacity:1"},1)},!1),n.addEventListener("click",function(){n.parentNode.parentNode.style="opacity:0",setTimeout(function(){n.parentNode.parentNode.className="hide"},500)},!1),e.querySelector("#setBgBox ul").addEventListener("click",function(e){var n=t.event||e;"IMG"===n.target.nodeName&&(r.style.background="url("+l[n.target.dataset.flag]+") center no-repeat")},!1)};c(),a(),u(),s(),p(),d(),y(),h()}(document,window);