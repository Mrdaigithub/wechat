"use strict";!function(e,t){var n=e.body,r=(e.querySelector("main"),e.querySelector("footer")),i=function(e){return Array.prototype.sort.call(e,function(){return Math.random()>.5?1:-1}),e},l=function(){var t=Array.prototype.slice.call(e.querySelectorAll("main>div"));t.forEach(function(e){"block"===e.style.display&&(e.style.display="none")})},o=function(){var t=e.querySelector("#indexBtn");t.addEventListener("click",function(){l(),e.querySelector("main").style.display="none"},!1)},c=function(){var t="",n=e.querySelector(".signIn header i"),r=e.querySelector(".signIn ul"),i=function o(e){$.getJSON(e,function(e){if(t!==JSON.stringify(e)){var i="";t=JSON.stringify(e),n.innerHTML=e.length,e.forEach(function(e){e.headimgurl||(e.headimgurl="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"),i+="<li><img src="+e.headimgurl+' alt="headImg"><p>'+e.nickname+"</p></li>"}),r.innerHTML=i}}),setTimeout(function(){o(e)},5e3)};e.querySelector("#SignBtn").addEventListener("click",function(){l(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),e.querySelector(".signIn").style.display="block",i("http://120.26.53.25/wechat/Project/api/getActiveUser/")},!1)},a=function(){var n=e.querySelector("#timeBtn");n.addEventListener("click",function(){var n=e.querySelector(".time"),r=e.querySelector("#timeText"),i=e.querySelector(".time button");l(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),n.style.display="block";var o=echarts.init(document.getElementById("timeBox")),c={total:60,used:0};r.innerHTML=c.total-c.used,r.style.marginLeft=-parseInt(t.getComputedStyle(r,null).width)/2+"px",r.style.marginTop=-parseInt(t.getComputedStyle(r,null).height)/2+"px";var a={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};o.setOption(a);var u=function s(){if(c.used>=60)return r.innerHTML="时间到",r.style.marginLeft=-parseInt(t.getComputedStyle(r,null).width)/2+"px",r.style.marginTop=-parseInt(t.getComputedStyle(r,null).height)/2+"px",i.removeAttribute("disabled"),!0;c.used++,r.style.marginLeft=-parseInt(t.getComputedStyle(r,null).width)/2+"px",r.style.marginTop=-parseInt(t.getComputedStyle(r,null).height)/2+"px";var e={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};o.setOption(e),r.innerHTML=c.total-c.used,setTimeout(s,1e3)};i.addEventListener("click",function(){i.setAttribute("disabled","disabled"),u()},!1)},!1)},u=function(){var n=function(t){var n="";t.forEach(function(e){n+="<li>"+e.level+"</li>"}),e.querySelector(".prizeLevel ul").innerHTML=n,e.querySelector(".prizeLevel p i").innerHTML=e.querySelector(".prizeLevel ul").firstElementChild.innerHTML},r=function(){"hide"===e.querySelector(".prizeLevel ul").className?e.querySelector(".prizeLevel ul").className="show":e.querySelector(".prizeLevel ul").className="hide"},o=function(t){t.forEach(function(t){t.level===e.querySelector(".prizeLevel p i").innerHTML&&(e.querySelector(".prizePic img").src=t.picUrl)})},c=function(t,n){var r=0,i=n.length;t.forEach(function(t){e.querySelector(".prizeLevel p i").innerHTML===t.level&&(r=t.num)}),e.querySelector(".prizeNum span").innerHTML>Math.min(r,i)&&(e.querySelector(".prizeNum span").innerHTML=Math.min(r,i));for(var l="",o=0;o<e.querySelector(".prize .pull-right .prizeNum span").innerHTML;o++)l+='<li><img src="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"><p>...</p></li>';e.querySelector(".prize .pull-left ul").innerHTML=l},a=function s(t,n,r,i){var l=Array.prototype.slice.call(e.querySelectorAll(".prize .pull-left ul li"));console.log(n);for(var o=function(e){l.forEach(function(r){r.querySelector("img").src=t[n[e]].headimgurl,r.querySelector("p").innerHTML=t[n[e]].nickname})},c=0;c<n.length;c++)o(c);setTimeout(function(){s(n,r,i)},r)},u=function(e,t){for(var n=[],r=0;r<t.length;r++)n.push(r);n=i(n),a(t,n,1e3,0)};e.querySelector("#giftBtn").addEventListener("click",function(){l(),"none"===e.querySelector("main").style.display&&(e.querySelector("main").style.display="block"),e.querySelector(".prize").style.display="block"},!1),$.getJSON("http://120.26.53.25/wechat/Project/api/getPrizeData/",function(i){$.getJSON("http://120.26.53.25/wechat/Project/api/getToPrizeUser/",function(l){n(i),o(i),e.querySelector(".prizeLevel").addEventListener("click",r,!1),e.querySelector(".prizeLevel ul").addEventListener("click",function(n){var r=t.event||n;"LI"===r.target.nodeName&&(e.querySelector(".prizeLevel p i").innerHTML=r.target.innerHTML,o(i),c(i,l))},!1),e.querySelector(".lessBtn").addEventListener("click",function(){var t=parseInt(e.querySelector(".prizeNum span").innerHTML);t>0&&(e.querySelector(".prizeNum span").innerHTML=--t,c(i,l))},!1),e.querySelector(".addBtn").addEventListener("click",function(){var t=l.length,n=0;i.forEach(function(t){t.level===e.querySelector(".prizeLevel i").innerHTML&&(n=t.num)});var r=parseInt(e.querySelector(".prizeNum span").innerHTML);r<Math.min(t,n)&&(e.querySelector(".prizeNum span").innerHTML=++r,c(i,l))},!1),e.querySelector(".prizeBtn").addEventListener("click",function(){u(i,l)},!1)})})},s=function(){var t=e.querySelector("#voteBtn");t.addEventListener("click",function(){var t=e.querySelector(".vote"),n="";t.className="vote show";var r=echarts.init(e.querySelector(".voteMain")),i=e.querySelector(".vote i"),l=function o(e){$.getJSON(e,function(e){if(n!==JSON.stringify(e)){var t=0;e.forEach(function(e){t+=parseInt(e.num)}),i.innerHTML=t;var l={color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:[e[0].lead,e[1].lead,e[2].lead,e[3].lead],axisTick:{alignWithLabel:!0},axisLabel:{textStyle:{color:"#fff"}}}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}}}],series:[{name:"票数",type:"bar",barWidth:"60%",data:[e[0].num,e[1].num,e[2].num,e[3].num]}]};r.setOption(l),n=JSON.stringify(e)}}),setTimeout(function(){o(e)},5e3)};l("http://120.26.53.25/wechat/Project/api/vote")},!1)},p=function(){r.addEventListener("mouseover",function(){r.className="hover"},!1),r.addEventListener("mouseout",function(){r.className=""},!1)},d=function(){var r=e.querySelector("#setCloseBtn"),i=e.querySelector("#setBtn"),l={bg1Url:"http://o7qephszd.bkt.clouddn.com/wechatBg1.jpg",bg2Url:"http://o7qephszd.bkt.clouddn.com/wechatBg2.jpg",bg3Url:"http://o7qephszd.bkt.clouddn.com/wechatBg3.jpg",bg4Url:"http://o7qephszd.bkt.clouddn.com/wechatBg4.jpg",bg5Url:"http://o7qephszd.bkt.clouddn.com/wechatBg5.jpg",bg6Url:"http://o7qephszd.bkt.clouddn.com/wechatBg6.jpg",bg7Url:"http://o7qephszd.bkt.clouddn.com/wechatBg7.jpg",bg8Url:"http://o7qephszd.bkt.clouddn.com/wechatBg8.jpg",bg9Url:"http://o7qephszd.bkt.clouddn.com/wechatBg9.jpg",bg10Url:"http://o7qephszd.bkt.clouddn.com/wechatBg10.jpg",bg11Url:"http://o7qephszd.bkt.clouddn.com/wechatBg11.jpg",bg12Url:"http://o7qephszd.bkt.clouddn.com/wechatBg12.jpg"};i.addEventListener("click",function(){r.parentNode.parentNode.className="show",setTimeout(function(){r.parentNode.parentNode.style="opacity:1"},1)},!1),r.addEventListener("click",function(){r.parentNode.parentNode.style="opacity:0",setTimeout(function(){r.parentNode.parentNode.className="hide"},500)},!1),e.querySelector("#setBgBox ul").addEventListener("click",function(e){var r=t.event||e;"IMG"===r.target.nodeName&&(n.style.background="url("+l[r.target.dataset.flag]+") center no-repeat")},!1)};o(),c(),a(),u(),s(),p(),d()}(document,window);