"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t){var r=e.body,n=(e.querySelector("main"),e.querySelector("footer")),i=function(e){return Array.prototype.sort.call(e,function(){return Math.random()>.5?1:-1}),e},o=function(e,t){if(t>e.length||t<=0)return!1;for(var r=[],n=0;n<t;n++){var i=Math.floor(Math.random()*e.length+1)-1;r.push(e.splice(i,1)[0])}return r},l=function(){var t=Array.prototype.slice.call(e.querySelectorAll("main>div"));t.forEach(function(e){"block"===e.style.display&&(e.style.display="none")})},c=function(){var t=e.querySelector("#indexBtn");t.addEventListener("click",function(){l(),e.querySelector("main").style.display="none"},!1)},a=function(){var t="",r=e.querySelector(".signIn header i"),n=e.querySelector(".signIn ul"),i=function o(e){$.getJSON(e,function(e){if(t!==JSON.stringify(e)){var i="";t=JSON.stringify(e),r.innerHTML=e.length,e.forEach(function(e){e.headimgurl||(e.headimgurl="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"),i+="<li><img src="+e.headimgurl+' alt="headImg"><p>'+e.nickname+"</p></li>"}),n.innerHTML=i}}),setTimeout(function(){o(e)},5e3)};e.querySelector("#SignBtn").addEventListener("click",function(){l(),e.querySelector(".signIn").style.display="block",i("http://120.26.53.25/wechat/Project/api/getActiveUser/")},!1)},u=function(){var r=e.querySelector("#timeBtn");r.addEventListener("click",function(){var r=e.querySelector(".time"),n=e.querySelector("#timeText"),i=e.querySelector(".time button");l(),r.style.display="block";var o=echarts.init(document.getElementById("timeBox")),c={total:60,used:0};n.innerHTML=c.total-c.used,n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px";var a={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};o.setOption(a);var u=function p(){if(c.used>=60)return n.innerHTML="时间到",n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px",i.removeAttribute("disabled"),!0;c.used++,n.style.marginLeft=-parseInt(t.getComputedStyle(n,null).width)/2+"px",n.style.marginTop=-parseInt(t.getComputedStyle(n,null).height)/2+"px";var e={series:[{type:"pie",radius:["50%","70%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},data:[{value:c.used,name:""},{value:c.total-c.used,name:""}]}]};o.setOption(e),n.innerHTML=c.total-c.used,setTimeout(p,50)};i.addEventListener("click",function(){i.setAttribute("disabled","disabled"),u()},!1)},!1)},p=function y(){var r=e.querySelector(".prizeLevel ul"),n=(e.querySelector(".prizeNum"),e.querySelector("#giftBtn")),y=e.querySelector(".prize"),c=!1;n.addEventListener("click",function(){l(),y.style.display="block"},!1),$.getJSON("http://120.26.53.25/wechat/Project/api/getPrizeInfo/",function(n){var l="";n.forEach(function(e){l+="<li>"+e.level+"</li>"}),r.innerHTML=l,e.querySelector(".prizeLevel p i").innerHTML=r.firstChild.innerHTML,$.getJSON("http://120.26.53.25/wechat/Project/api/getActiveUser/",function(l){var a=function u(t,r,a){for(var p=arguments.length<=3||void 0===arguments[3]?0:arguments[3],s=[],d=0;d<t.length;d++){for(var h=[],y=0;y<r.length;y++)h.push(y);s.push(i(h))}p>=s[0].length&&(p=0);for(var f=0;f<t.length;f++)r[s[f][p]].headimgurl||(r[s[f][p]].headimgurl="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"),t[f].querySelector("img").src=r[s[f][p]].headimgurl,t[f].querySelector("p").innerHTML=r[s[f][p]].nickname;setTimeout(function(){if(!c){var i=function(){for(var i=[],c=0;c<r.length;c++)i.push(c);for(var a=o(i,e.querySelectorAll(".prize .pull-left li").length),u=0;u<e.querySelectorAll(".prize .pull-left li").length;u++)t[u].querySelector("img").src=r[a[u]].headimgurl,t[u].querySelector("p").innerHTML=r[a[u]].nickname;var p=[];return t.forEach(function(t){var r={};r.openid=l,l.forEach(function(i){t.querySelector("p").innerHTML===i.nickname&&(r.openid=i.openid,n.forEach(function(t){t.picUrl===e.querySelector(".prizePic img").src&&(r.prizeid=t.id)}))}),p.push(r)}),$.ajax({type:"POST",url:"http://120.26.53.25/wechat/Project/api/receivePrizeUser/",data:JSON.stringify(p),success:function(e){}}),{v:0}}();if("object"===("undefined"==typeof i?"undefined":_typeof(i)))return i.v}u(t,r,a,++p)},a)};n.forEach(function(t){t.level===e.querySelector(".prizeLevel p i").innerHTML&&(e.querySelector(".prizePic img").src=t.picUrl)}),r.addEventListener("click",function(i){var o=t.event||i;"LI"===o.target.nodeName&&(e.querySelector(".prizeLevel p i").innerHTML=o.target.innerHTML,r.className="hide",e.querySelector(".prizeLevel p span").className="caret",n.forEach(function(t){if(t.level===e.querySelector(".prizeLevel p i").innerHTML&&(e.querySelector(".prizePic img").src=t.picUrl,parseInt(e.querySelector(".prizeNum span").innerHTML)>parseInt(t.num))){e.querySelector(".prizeNum span").innerHTML=t.num,e.querySelector(".prize .pull-left ul").innerHTML="";for(var r=0;r<parseInt(t.num);r++)e.querySelector(".prize .pull-left ul").innerHTML+='<li><img src="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"><p>...</p></li>';e.querySelector(".prizeBtn").addEventListener("click",function(){},!1)}}))},!1),e.querySelector(".prizeLevel p").addEventListener("click",function(){"hide"===r.className?(r.className="show",e.querySelector(".prizeLevel p span").className="caret toTop"):(r.className="hide",e.querySelector(".prizeLevel p span").className="caret")},!1),e.querySelector(".lessBtn ").addEventListener("click",function(){var t=parseInt(e.querySelector(".prizeNum span").innerHTML);t>0&&(e.querySelector(".prizeNum span").innerHTML=--t,e.querySelector(".prize .pull-left ul").innerHTML=e.querySelector(".prize .pull-left ul").innerHTML.replace(/<li><img.+?\/li>/i,""))},!1),e.querySelector(".addBtn ").addEventListener("click",function(){var t=l.length,r=0;n.forEach(function(t){t.level===e.querySelector(".prizeLevel i").innerHTML&&(r=t.num)});var i=parseInt(e.querySelector(".prizeNum span").innerHTML);i<Math.min(t,r)&&(e.querySelector(".prizeNum span").innerHTML=++i,e.querySelector(".prize .pull-left ul").innerHTML+='<li><img src="http://o7qephszd.bkt.clouddn.com/wechatDefaultHeadImg.png"><p>...</p></li>')},!1),e.querySelector(".prizeBtn").addEventListener("click",function(){"start"===e.querySelector(".prizeBtn").innerHTML?(e.querySelector(".prizeBtn").innerHTML="stop",$.getJSON("http://120.26.53.25/wechat/Project/api/getToPrizeUser/",function(t){c=!0,a(e.querySelectorAll(".prize .pull-left li"),t,100)})):(e.querySelector(".prizeBtn").innerHTML="start",c=!1)},!1)})})},s=function(){var t=e.querySelector("#voteBtn");t.addEventListener("click",function(){var t=e.querySelector(".vote"),r="";t.className="vote show";var n=echarts.init(e.querySelector(".voteMain")),i=e.querySelector(".vote i"),o=function l(e){$.getJSON(e,function(e){if(r!==JSON.stringify(e)){var t=0;e.forEach(function(e){t+=parseInt(e.num)}),i.innerHTML=t;var o={color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:[e[0].lead,e[1].lead,e[2].lead,e[3].lead],axisTick:{alignWithLabel:!0},axisLabel:{textStyle:{color:"#fff"}}}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}}}],series:[{name:"票数",type:"bar",barWidth:"60%",data:[e[0].num,e[1].num,e[2].num,e[3].num]}]};n.setOption(o),r=JSON.stringify(e)}}),setTimeout(function(){l(e)},5e3)};o("http://120.26.53.25/wechat/Project/api/vote")},!1)},d=function(){n.addEventListener("mouseover",function(){console.log("as"),n.className="hover"},!1),n.addEventListener("mouseout",function(){n.className=""},!1)},h=function(){var n=e.querySelector("#setCloseBtn"),i=e.querySelector("#setBtn"),o={bg1Url:"http://o7qephszd.bkt.clouddn.com/wechatBg1.jpg",bg2Url:"http://o7qephszd.bkt.clouddn.com/wechatBg2.jpg",bg3Url:"http://o7qephszd.bkt.clouddn.com/wechatBg3.jpg",bg4Url:"http://o7qephszd.bkt.clouddn.com/wechatBg4.jpg",bg5Url:"http://o7qephszd.bkt.clouddn.com/wechatBg5.jpg",bg6Url:"http://o7qephszd.bkt.clouddn.com/wechatBg6.jpg",bg7Url:"http://o7qephszd.bkt.clouddn.com/wechatBg7.jpg",bg8Url:"http://o7qephszd.bkt.clouddn.com/wechatBg8.jpg",bg9Url:"http://o7qephszd.bkt.clouddn.com/wechatBg9.jpg",bg10Url:"http://o7qephszd.bkt.clouddn.com/wechatBg10.jpg",bg11Url:"http://o7qephszd.bkt.clouddn.com/wechatBg11.jpg",bg12Url:"http://o7qephszd.bkt.clouddn.com/wechatBg12.jpg"};i.addEventListener("click",function(){n.parentNode.parentNode.className="show",setTimeout(function(){n.parentNode.parentNode.style="opacity:1"},1)},!1),n.addEventListener("click",function(){n.parentNode.parentNode.style="opacity:0",setTimeout(function(){n.parentNode.parentNode.className="hide"},500)},!1),e.querySelector("#setBgBox ul").addEventListener("click",function(e){var n=t.event||e;"IMG"===n.target.nodeName&&(r.style.background="url("+o[n.target.dataset.flag]+") center no-repeat")},!1)};c(),a(),u(),p(),s(),d(),h()}(document,window);